"""
图片转Excel工具 - 张金平3
从图片文件中识别表格数据，转换为Excel xlsx格式
专门处理 grd21yr23__张金平3.png
"""

import os
import pandas as pd
from pathlib import Path


def get_table_data():
    """
    根据图片描述获取表格数据（无表头）
    返回: 数据行列表
    """
    data_rows = [
        ['林明浩', '120211330113', '能科2102', 86, 50, 64],
        ['高远洋', '120211100105', '能科2103', 86, 58, 69],
        ['赖传睿', '120211100109', '能科2103', 93, 82, 86],
        ['宋昆阳', '120211100117', '能科2103', 87, 64, 73],
        ['苏义茜', '120211100118', '能科2103', 86, 58, 69],
        ['徐梦柳', '120211100124', '能科2103', 86, 49, 64],
        ['赖姝颖', '120211100206', '能科2103', 87, 67, 75],
        ['李帅男', '120211100209', '能科2103', 87, 63, 73],
        ['欧兴桂', '120211100214', '能科2103', 93, 84, 88],
        ['王昊', '120211100219', '能科2103', 87, 69, 76],
        ['纪天予', '120211100309', '能科2103', 93, 83, 87],
        ['彭泽辰', '120211100317', '能科2103', 86, 50, 64],
        ['魏丽轩', '120211100324', '能科2103', 100, 93, 96],
        ['杨倩', '120211100326', '能科2103', 100, 96, 98],
        ['张昊通', '120211100329', '能科2103', 93, 87, 89],
        ['龚思琪', '120211100405', '能科2103', 93, 84, 88],
        ['黎翰林', '120211100411', '能科2103', 88, 80, 83],
        ['刘娟', '120211100415', '能科2103', 88, 71, 78],
        ['高佳宁', '120211100502', '能科2103', 93, 81, 86],
        ['孟若璇', '120211100516', '能科2103', 88, 76, 81],
        ['全红阳', '120211100518', '能科2103', 100, 90, 94],
        ['滕林锋', '120211100522', '能科2103', 87, 69, 76],
        ['周成睿', '120211100529', '能科2103', 87, 68, 76],
        ['陈钰', '120211100602', '能科2103', 86, 56, 68],
        ['梁泽佳', '120211100617', '能科2103', 86, 48, 63],
        ['卢奇励', '120211100618', '能科2103', 88, 78, 82],
        ['董烨', '120211100707', '能科2103', 93, 82, 86],
        ['冯鑫宇', '120211100708', '能科2103', 100, 97, 98],
        ['贺岗', '120211100709', '能科2103', 88, 70, 77],
        ['吉雁冰', '120211100712', '能科2103', 75, 30, 48],
        ['廖梓丞', '120211100715', '能科2103', 100, 92, 95],
        ['苗梦婷', '120211100719', '能科2103', 87, 69, 76],
        ['孙嘉锐', '120211130515', '能科2103', 93, 85, 88],
        ['许文旭', '120171140117', '信管1901', '缺考'],
    ]
    
    return data_rows


def image_to_xlsx(xlsx_path):
    """
    将表格数据转换为Excel文件（无表头）
    
    参数:
        xlsx_path: 输出的Excel文件路径
    """
    # 确保输出目录存在
    output_dir = os.path.dirname(xlsx_path)
    if output_dir and not os.path.exists(output_dir):
        os.makedirs(output_dir)
    
    print("\n[信息] 开始处理表格数据...")
    
    # 获取数据
    data_rows = get_table_data()
    print(f"[信息] 已加载 {len(data_rows)} 行数据")
    
    # 创建 DataFrame（无表头）
    df = pd.DataFrame(data_rows)
    
    # 保存为 Excel 文件（不包含表头）
    with pd.ExcelWriter(xlsx_path, engine='openpyxl') as writer:
        df.to_excel(writer, sheet_name='Sheet1', index=False, header=False)
    
    print(f"\n[成功] 转换完成！")
    print(f"  输出文件: {xlsx_path}")
    print(f"  数据行数: {len(df)}")
    print(f"  数据列数: {len(df.columns)}")
    return True


if __name__ == '__main__':
    # 设置路径
    base_dir = Path(__file__).parent
    
    # 输出Excel文件路径
    xlsx_file = base_dir / 'scores3_xlsx' / 'grd21yr23__张金平3.xlsx'
    
    # 执行转换
    result = image_to_xlsx(str(xlsx_file))
    if result:
        print(f"\n转换完成，文件已保存到 {xlsx_file}")
    else:
        print(f"\n转换失败")

