"""
图片转Excel工具 - 张金平2
从图片文件中识别表格数据，转换为Excel xlsx格式
专门处理 grd21yr23__张金平2.png
"""

import os
import pandas as pd
from pathlib import Path


def get_table_data():
    """
    根据图片描述获取表格数据（无表头）
    返回: 数据行列表
    """
    data_rows = [
        ['李静戈', '120211120310', '能科2101', 86, 50, 64],
        ['肖东坡', '120211120320', '能科2101', 88, 77, 81],
        ['高国栋', '120211100104', '能科2102', 88, 79, 83],
        ['黄玉超', '120211100108', '能科2102', 87, 60, 71],
        ['刘耀文', '120211100113', '能科2102', 86, 45, 61],
        ['钱承炫', '120211100116', '能科2102', 100, 98, 99],
        ['赵尚文', '120211100130', '能科2102', 100, 100, 100],
        ['徐梦晗', '120211100224', '能科2102', 88, 77, 81],
        ['燕孜繁', '120211100225', '能科2102', 88, 77, 81],
        ['陈浏英杰', '120211100301', '能科2102', 85, 44, 60],
        ['陈颖', '120211100303', '能科2102', 87, 64, 73],
        ['孙雨轩', '120211100318', '能科2102', 88, 70, 77],
        ['王豪杰', '120211100320', '能科2102', 86, 53, 66],
        ['花子洋', '120211100408', '能科2102', 93, 89, 91],
        ['山成明', '120211100417', '能科2102', 75, 31, 49],
        ['杨舒涵', '120211100425', '能科2102', 86, 50, 64],
        ['洪科程', '120211100503', '能科2102', 88, 74, 80],
        ['尚峙澎', '120211100519', '能科2102', 87, 63, 73],
        ['邓清耀', '120211100603', '能科2102', 93, 83, 87],
        ['谷智轩', '120211100606', '能科2102', 93, 83, 87],
        ['李峰航', '120211100612', '能科2102', 88, 73, 79],
        ['李牧其', '120211100613', '能科2102', 93, 87, 89],
        ['马悦', '120211100619', '能科2102', 88, 72, 78],
        ['艾仙乐', '120211100702', '能科2102', 88, 72, 78],
        ['陈怡宇', '120211100704', '能科2102', 88, 75, 80],
        ['崔博壹', '120211100706', '能科2102', 88, 70, 77],
        ['胡佳鑫', '120211100710', '能科2102', 88, 78, 82],
        ['黄永新', '120211100711', '能科2102', 88, 75, 80],
        ['宋佩蓉', '120211100721', '能科2102', 93, 84, 88],
        ['薛皓木', '120211100725', '能科2102', 88, 71, 78],
        ['张子扬', '120211100727', '能科2102', 87, 64, 73],
        ['丁奕萌', '120211120403', '能科2102', 88, 72, 78],
        ['郑喆元', '120211130328', '能科2102', 87, 67, 75],
        ['马跃明', '120211130512', '能科2102', 93, 86, 89],
        ['何宇飞', '120211150209', '能科2102', 88, 70, 77],
    ]
    
    return data_rows


def image_to_xlsx(xlsx_path):
    """
    将表格数据转换为Excel文件（无表头）
    
    参数:
        xlsx_path: 输出的Excel文件路径
    """
    # 确保输出目录存在
    output_dir = os.path.dirname(xlsx_path)
    if output_dir and not os.path.exists(output_dir):
        os.makedirs(output_dir)
    
    print("\n[信息] 开始处理表格数据...")
    
    # 获取数据
    data_rows = get_table_data()
    print(f"[信息] 已加载 {len(data_rows)} 行数据")
    
    # 创建 DataFrame（无表头）
    df = pd.DataFrame(data_rows)
    
    # 保存为 Excel 文件（不包含表头）
    with pd.ExcelWriter(xlsx_path, engine='openpyxl') as writer:
        df.to_excel(writer, sheet_name='Sheet1', index=False, header=False)
    
    print(f"\n[成功] 转换完成！")
    print(f"  输出文件: {xlsx_path}")
    print(f"  数据行数: {len(df)}")
    print(f"  数据列数: {len(df.columns)}")
    return True


if __name__ == '__main__':
    # 设置路径
    base_dir = Path(__file__).parent
    
    # 输出Excel文件路径
    xlsx_file = base_dir / 'scores3_xlsx' / 'grd21yr23__张金平2.xlsx'
    
    # 执行转换
    result = image_to_xlsx(str(xlsx_file))
    if result:
        print(f"\n转换完成，文件已保存到 {xlsx_file}")
    else:
        print(f"\n转换失败")

